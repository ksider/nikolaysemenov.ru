<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FTIR Merger</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />
  <link rel="stylesheet" href="styles.css">
  <script src="./d3.min.js"></script>
  <script src="./jcampconverter.min.js"></script>
</head>
<body>
  <div class="bg-accent"></div>
  <div class="app-shell">
    <header class="topbar surface">
      <div class="brand">
        <img src="logo.png" alt="FTIR Merger logo" class="brand-logo" />
        <div class="brand-copy">
          <p class="eyebrow">Spectra workspace</p>
          <strong>FTIR viewer</strong>
        </div>
      </div>
      <div class="topbar-form toolbar">
        <input id="files" type="file" accept=".txt,.jdx,.dx,.jsm,.jcm,text/plain,application/octet-stream" multiple style="display:none;">
        <input id="importSessionInput" type="file" accept=".json" style="display:none;">
        <div class="toolbar-group">
          <button id="selectFiles" class="icon-btn primary" type="button" title="Add files" aria-label="Add files">
            <span class="material-symbols-outlined">upload_file</span>
          </button>
          <button id="exportSession" class="icon-btn" type="button" title="Export session" aria-label="Export session">
            <span class="material-symbols-outlined">file_download</span>
          </button>
          <button id="importSession" class="icon-btn" type="button" title="Import session" aria-label="Import session">
            <span class="material-symbols-outlined">file_open</span>
          </button>
          <button id="copyPng" class="icon-btn" type="button" title="Copy chart PNG" aria-label="Copy chart PNG">
            <span class="material-symbols-outlined">image</span>
          </button>
          <button id="copySvg" class="icon-btn" type="button" title="Copy chart SVG" aria-label="Copy chart SVG">
            <span class="material-symbols-outlined">code</span>
          </button>
          <button id="saveCsv" class="icon-btn success" type="button" title="Save CSV" aria-label="Save CSV">
            <span class="material-symbols-outlined">save</span>
          </button>
        </div>
        <div class="toolbar-group name-group">
          <label class="visually-hidden" for="fileName">CSV name</label>
          <input id="fileName" type="text" class="save-name" value="merged.csv" aria-label="CSV file name">
        </div>
      </div>
      <div class="lang-switch">
        <a href="#" class="lang-link" data-lang="en">EN</a>
        <a href="#" class="lang-link" data-lang="ru">RU</a>
        <a href="#" class="lang-link" data-lang="sr">SR</a>
      </div>
    </header>

    <div class="card surface">
      <div class="inline-row inline-row--sub">
        <p class="helper">Multi-select supported. Each column will match the file name.</p>
        <div class="status-block">
          <div id="status"></div>
          <div id="downloadLink"></div>
        </div>
      </div>

      <div class="chart-row is-hidden" id="chartRow">
        <div>
          <div id="zoneHint" class="zone-hint"></div>
          <div id="chart"></div>
        </div>
        <div class="legend-wrap">
          <div id="chartLegend" class="legend"></div>
          <div id="chartControls" class="controls">
            <h3 data-i18n="chartSettings">Chart settings</h3>
            <div class="control-group">
              <label data-i18n="xRange">X range (reverse):</label>
              <div class="inline-inputs">
                <input id="xMax" type="number" value="4000" step="1" disabled>
                <span>→</span>
                <input id="xMin" type="number" value="500" step="1" disabled>
              </div>
            </div>
            <div class="control-group">
              <label data-i18n="yRange">Y range:</label>
              <div class="inline-inputs">
                <input id="yMin" type="number" step="0.1" placeholder="auto" disabled>
                <span>→</span>
                <input id="yMax" type="number" step="0.1" placeholder="auto" disabled>
              </div>
            </div>
            <div class="control-group baseline-group">
              <label data-i18n="baselineSection">Baseline fit</label>
              <div class="baseline-controls">
                <select id="baselineSeries"></select>
                <input id="baselineDegree" type="number" min="1" max="6" step="1" value="2">
                <button id="baselinePreview" type="button" class="btn tonal" disabled data-i18n="baselinePreview">Preview</button>
                <button id="baselineApply" type="button" class="btn tonal" disabled data-i18n="baselineApply">Apply</button>
                <button id="baselineRevert" type="button" class="btn tonal" disabled data-i18n="baselineRevert">Revert</button>
              </div>
            </div>
            <div class="control-actions">
              <button id="refreshChart" type="button" class="icon-btn" disabled title="Refresh chart" aria-label="Refresh chart">
                <span class="material-symbols-outlined">refresh</span>
              </button>
              <button id="resetZoom" type="button" class="icon-btn" disabled title="Reset zoom" aria-label="Reset zoom">
                <span class="material-symbols-outlined">zoom_out_map</span>
              </button>
              <div class="save-wrap">
                <input id="fileName" type="text" class="save-name" value="merged.csv" aria-label="CSV file name">
                <button id="saveCsv" type="button" class="btn success" disabled data-i18n="saveCsv">Save CSV</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="card surface peaks-card">
      <div class="peaks-header">
        <h3 data-i18n="peaksTitle">Peaks / stripes</h3>
        <div class="peaks-actions">
          <button id="addStripe" type="button" class="btn tonal" data-i18n="addStripe">Add stripe</button>
          <button id="copyStripes" type="button" class="btn tonal" data-i18n="copyStripes">Copy table</button>
          <p class="peaks-hint" data-i18n="peakHint">Click the chart to place a marker, then add it here.</p>
        </div>
      </div>
      <div class="peaks-table">
        <div class="stripe-sets">
          <button class="stripe-set-btn active" data-set="candidates">Candidates</button>
          <button class="stripe-set-btn" data-set="confirmed">Confirmed</button>
        </div>
        <div class="peaks-row peaks-head">
          <span> </span>
          <span data-i18n="colWave">Wavenumber</span>
          <span data-i18n="colLabel">Label</span>
          <span data-i18n="colTip">Tip</span>
          <span> </span>
        </div>
        <div id="peaksEmpty" class="peaks-empty" data-i18n="peaksEmpty">No stripes yet. Set a marker and add it here.</div>
        <div id="peaksBody" class="peaks-body"></div>
      </div>
    </div>
    <footer class="footer surface">
      <div class="footer-links">
        <a id="footerSite" href="#" rel="noopener" target="_blank">nikolaysemenov.ru</a>
        <span class="dot">•</span>
        <a id="footerGithub" href="#" rel="noopener" target="_blank">GitHub</a>
      </div>
    </footer>
  </div>

  <script src="./config.js"></script>
  <script src="./peak-db.js"></script>
  <script src="./app.js"></script>
</body>
</html>
